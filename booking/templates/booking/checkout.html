<html>
  <head>
    <title>Checkout</title>
  </head>
  <body>
    <h1>Checkout Page</h1>
    <form action="{% url 'create_checkout_session' %}" method="POST">
      {% csrf_token %}
    <button type="submit" id="checkout-button">pay now</button>


  <script src="https://js.stripe.com/v3/"></script>
<script>
  var stripe = Stripe("{{ STRIPE_PUBLISHABLE_KEY }}");
  document.getElementById("checkout-button").addEventListener("click", function () {
    fetch("/create-checkout-session/", {
      method: "POST",
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
      },
    })
    .then(function(response) { return response.json(); })
    .then(function(session) {
      return stripe.redirectToCheckout({ sessionId: session.id });
    })
    .then(function(result) {
      if (result.error) {
        alert(result.error.message);
      }
    });
  });
</script>
</html>
